- name: update and upgrade apt 
  apt: 
    update_cache: yes
    upgrade: safe

- name: Install Docker
  apt:
   name: docker.io
   state: present

- name: Change ownership of /var/run/docker.sock
  file:
    path: /var/run/docker.sock
    group: docker
    state: touch

- name: give read/write permission to docker group
  file: 
     path: /var/run/docker.sock
     mode: "0666"

- name: add jenkins to docker group
  user:
    name: jenkins
    groups: docker
    append: yes

- name: restart Docker 
  service: 
    name: docker
    state: restarted

- name: restart jenkins
  service:
    name: jenkins
    state: restarted

- name: retrieve jenkins initial password
  command: "cat /var/lib/jenkins/secrets/initialAdminPassword"
  register: jenkins_initial_password
  
- name: display jenkins initial Password
  debug: 
    var: jenkins_initial_password.stdout

